metadata:
  name: insights-malware-install
  # you can add additional metadata here
  instructional: true
spec:
  displayName: Installing and registering the malware detection service
  durationMinutes: 10
  # Optional type section, will display as a tile on the card
  type:
    text: Quick start
    # 'blue' | 'cyan' | 'green' | 'orange' | 'purple' | 'red' | 'grey'
    color: green
  icon: data:image/svg+xml;base64,PCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj4KPHRpdGxlPjwvdGl0bGU+CjxnIGlkPSJpY29tb29uLWlnbm9yZSI+CjwvZz4KPHBhdGggZD0iTTQ0OCA2NHY0MTZoLTMzNmMtMjYuNTEzIDAtNDgtMjEuNDktNDgtNDhzMjEuNDg3LTQ4IDQ4LTQ4aDMwNHYtMzg0aC0zMjBjLTM1LjE5OSAwLTY0IDI4LjgtNjQgNjR2Mzg0YzAgMzUuMiAyOC44MDEgNjQgNjQgNjRoMzg0di00NDhoLTMyeiI+PC9wYXRoPgo8cGF0aCBkPSJNMTEyLjAyOCA0MTZ2MGMtMC4wMDkgMC4wMDEtMC4wMTkgMC0wLjAyOCAwLTguODM2IDAtMTYgNy4xNjMtMTYgMTZzNy4xNjQgMTYgMTYgMTZjMC4wMDkgMCAwLjAxOS0wLjAwMSAwLjAyOC0wLjAwMXYwLjAwMWgzMDMuOTQ1di0zMmgtMzAzLjk0NXoiPjwvcGF0aD4KPC9zdmc+Cg==
  prerequisites:
    - The system operating system must be Red Hat Enterprise Linux (RHEL) 8 or RHEL 9.
    - You must be a Malware detection administrator in the Hybrid Cloud Console and have sudo access to your RHEL system. 
    - The system must have the Red Hat Lightspeed client package installed, and be registered to Red Hat Lightspeed for RHEL.
  description: |-

    Install, test and run the malware detection service.
    
  introduction: |-
    To get started using the Red Hat Lightspeed malware service, you will install YARA, the insights-client and scan your system for malware. YARA is an open-source and multi-platform tool that detects code similarities between predefined malware signatures and a scanned RHEL 
    system. If one or more conditions in a predefined signature exist on a scanned RHEL system, YARA records a malware hit on that system. If a malware issue is identified, it will be highlighted in the UI for you to proactively address with your information security team.
   
  tasks:
    - title: Install the insights-client and register your system
      description: |-    
      
        You will install YARA, the insights-client and register your system. Enter the following commands in your Command Line Interface on your RHEL system.

          1. Install YARA: 

          ```
          $ sudo dnf install yara
          ```
          2. Install the insights-client RPM:

          ```
          $ sudo dnf install insights-client
          ```
          3. Test the insights-client connection:

          ```
          $ sudo insights-client --test-connection
          ```
          4. Register the system with Red Hat Lightspeed for Red Hat Enterprise Linux:

          ```
          $ sudo insights-client --register
          ```
        
        After everything is successfully installed and registered, you can run the initial and full scan of the malware collection detector. 

    - title: Run the malware detection collector
      description: |-
        There are two stages of running the malware detection collector: an initial test scan and a full filesystem scan. The initial test scan of your system uses a simple test rule. The test scan is designed to verify that the installation, operation, and uploads are working 
        correctly for the malware detection service. There will be a few  matches found, but this is
        for testing purposes and nothing to act upon. 

        1. Run the insights-client malware detection collector:
        ```
        $ sudo insights-client --collector malware-detection
        ```

        The initial run creates a malware detection configuration file in 
        `/etc/insights-client/malware-detection-config.yml`, performs a test scan, 
        and uploads the results.

        Now, you will run a full filesystem scan.
          
          2. Before performing a full filesystem scan, edit
           `/etc/insights-client/malware-detection-config.yml` with the following settings:

              a. Set the test scan option from true to false 

              `test_scan: false`

              b. Minimize scan time by setting any of the following options: 
              ```
              Filesystem_scan_only
              ```

              ```
              Filesystem_scan_exclude
              ```

              ```
              Filesystem_scan_since
              ```
              
              c. Re-run the client malware detection collector:
              ```
              $ sudo insights-client --collector malware-detection
              ```

          Once you have completed the test run and full filesystem scan, you are ready to view your results in the Red Hat Lightspeed dashboard.

    - title: Review YARA matches in the Red Hat Lightspeed dashboard
      description: |- 
      
          1. Click **Security** in the left navigation panel. 
          2. Select **Malware** in the dropdown.
          3. You can click on **Systems** and **Signatures** to see different views.

          In most cases running a malware detection scan with YARA will result in **no signature matches**.
          If the scan does detect a match, provide the details of that match to your security incident response team.
  review:
    instructions: |-
      - Did you complete the task successfully?
      failedTaskHelp: This task isn't verified yet. Try the task again.
      summary:
        success: Shows a success message in the task header
 
        failed: Shows a failed message in the task header

  conclusion: |-  

    <h4><b>Thank you for taking the time to explore this feature!</b></h4> 

    For additional information about the malware detection service, [visit the malware detection documentation](https://docs.redhat.com/en/documentation/red_hat_lightspeed/1-latest/html-single/assessing_and_reporting_malware_signatures_on_rhel_systems/index#installing-yara-and-configuring-insights-client_malware-svc-getting-started). 
        
    If you need additional assistance, [open a support case](https://access.redhat.com/support).     


